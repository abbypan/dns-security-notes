# forwarding recursive resolver

forwarding recursive resolver 负责从查询方接收域名查询请求；如果本地没有缓存该域名的资源记录，则向该域名的权威服务器查询该域名的资源记录后，返回给查询方。

forwarding dns对外发送的是迭代查询，以查询www.qq.com的A记录为例：

1) 检查本地是否缓存www.qq.com的A记录，如果有，转7)；否则，转2)。

2) 检查本地是否缓存qq.com的NS记录，如果有，转6)；否则，转3)。

3) 检查本地是否缓存com的NS记录，如果有，转5)；否则，转4)。

4) 随机选择本地配置的某一个根服务器，查询并缓存com的NS记录。

5) 随机选择com的某一个NS服务器，查询并缓存qq.com的NS记录。

6) 随机选择qq.com的某一个NS服务器，查询并缓存www.qq.com的A记录。

7) 返回www.qq.com的A记录。

# 一些评测点

## 吞吐量

每秒支持多少次查询

测吞吐量可以用resperf

相关参数：
- 一次查询所需的CPU time，网卡吞吐量，带宽，缓存命中时能支持的最大查询次数p，缓存未命中时能支持的最大查询次数q；
- 实际的吞吐量介于p与q之间，靠近p还是靠近q与实际查询命中率相关；
- q还与递归查询的深度有关

## 时延

平均每次查询返回时长

相关参数：重复查询量，网络质量，失败查询率，客户端查询失败后的重试次数，客户端超时重试时长

客户端超时重试时长与bind8及其之前的查询算法有关：
- bind发现找不到name server的ip，会马上跑去查；
- 但是查完之后，不会再去查客户端之前发起的query，而会等客户端超时重试再去查；
- 此时总时延就与客户端超时重试时长有关

测时延可以用dnsperf

## 解析查询包

解析查询流量的pcap包可以用queryparse
